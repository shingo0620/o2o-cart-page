var t=Object.defineProperty,e=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,c=(e,a,r)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,n=(t,e)=>{for(var a in e||(e={}))s.call(e,a)&&c(t,a,e[a]);if(r)for(var a of r(e))o.call(e,a)&&c(t,a,e[a]);return t},i=(t,r)=>e(t,a(r));import{o as d,c as u,t as m,m as l,a as p,r as g,b as h,F as y,d as I,l as C,f,e as w,g as x,h as v,i as b,j as T,k as P,n as S,v as k,p as N,V as U}from"./vendor.719e09ba.js";const q={props:{shopName:{type:String,default:"我的商店"}}},O={class:"bg-gray-700 text-center text-white w-100 py-4"};q.render=function(t,e,a,r,s,o){return d(),u("nav",O,m(a.shopName)+" - 購物車 ",1)};const j={},F={class:"w-full absolute bottom-0 w-100 py-0 text-center text-gray-300 text-opacity-30"};j.render=function(t,e,a,r,s,o){return d(),u("footer",F," Copyright © 2021 蓋婭科技有限公司. All Rights Reserved. ")};const L={props:{modelValue:Number,productUuid:[Number,String]},methods:n({},l(["addToCart","removeFromCart","reduceFromCart"]))},D={class:"flex justify-around px-1"},V={class:"text-gray-800"};L.render=function(t,e,a,r,s,o){const c=g("font-awesome-icon");return d(),u("div",D,[a.modelValue>0?(d(),u(c,{key:0,icon:"minus",size:"lg",onClick:e[1]||(e[1]=e=>t.reduceFromCart(a.productUuid)),class:"text-gray-700 cursor-pointer"})):(d(),u(c,{key:1,icon:"trash",size:"lg",onClick:e[2]||(e[2]=e=>t.removeFromCart(a.productUuid)),class:"text-red-400 cursor-pointer"})),p("span",V,m(a.modelValue),1),p(c,{icon:"plus",size:"lg",onClick:e[3]||(e[3]=e=>t.addToCart(a.productUuid)),class:"text-gray-700 cursor-pointer"})])};const Q={name:"Cart",components:{QuantityPanel:L},computed:i(n({},h({items:t=>t.cartItems,products:t=>t.products})),{total(){return this.items.length<1||this.products.length<1?0:this.items.reduce(((t,e)=>{let a=this.products.find((t=>t.uuid===e.uuid));return t+e.quantity*a.unitPrice}),0)}}),methods:i(n({},l(["resetCart","checkout"])),{getProductByUuid(t){return this.products.find((e=>e.uuid===t))||{}}})},K={class:""},_={class:"flex flex-wrap w-full bg-gray-700 pb-2"},z={class:"w-6/12 bg-gray-200 p-1"},A={class:"w-6/12 bg-green-200 p-1"},R={class:"text-center w-9/12"},B={class:"p-5 bg-gray-700 text-white text-right"},$={key:0},J=p("span",null,"總價格",-1),H={class:"ml-2"},E={key:1,class:"text-center"};Q.render=function(t,e,a,r,s,o){const c=g("QuantityPanel");return d(),u("div",K,[p("div",_,[p("div",z,[p("button",{class:"w-full text-center rounded ring-2 ring-gray-700 ring-opacity-60",onClick:e[1]||(e[1]=(...e)=>t.resetCart&&t.resetCart(...e))},"清空購物車")]),p("div",A,[p("button",{class:"w-full text-center rounded ring-2 ring-gray-700 ring-opacity-60",onClick:e[2]||(e[2]=(...e)=>t.checkout&&t.checkout(...e))},"結帳")])]),(d(!0),u(y,null,I(t.items,(t=>(d(),u("div",{class:"py-5 px-2 flex w-full",key:t.uuid},[p("div",R,m(o.getProductByUuid(t.uuid).name)+" ($"+m(o.getProductByUuid(t.uuid).unitPrice)+") ",1),p(c,{class:"ml-auto w-3/12",modelValue:t.quantity,"onUpdate:modelValue":e=>t.quantity=e,productUuid:t.uuid},null,8,["modelValue","onUpdate:modelValue","productUuid"])])))),128)),p("div",B,[t.items.length>0?(d(),u("div",$,[J,p("span",H,"$"+m(o.total),1)])):(d(),u("div",E," 請掃描商品 QR Code "))])])};const G={components:{AppHeader:q,Cart:Q,AppFooter:j},data:()=>({scanning:!1}),computed:n({},h({shopId:t=>t.shopId,shopName:t=>t.shopName})),async mounted(){const t=new URL(window.location.href),e=t.searchParams.get("shopId");await this.getShop(e);const a=t.searchParams.get("addItem");a&&this.addToCart(a)},methods:i(n({},l(["getShop","createCart","restoreCart","addToCart"])),{onDecode(t){const e=new URL(t).searchParams.get("addItem");e&&this.addToCart(e),this.scanning=!1}})},M={key:0,class:"d-flex"},W={key:1};G.render=function(t,e,a,r,s,o){const c=g("AppHeader"),n=g("Cart"),i=g("AppFooter"),m=g("font-awesome-icon"),l=g("qrcode-stream");return s.scanning?(d(),u("div",W,[p(m,{icon:"times-circle",size:"4x",onClick:e[2]||(e[2]=t=>s.scanning=!1),class:"text-gray-700 cursor-pointer absolute right-3 bottom-3"}),p(l,{onDecode:o.onDecode},null,8,["onDecode"])])):(d(),u("div",M,[p(c,{shopName:t.shopName},null,8,["shopName"]),p(n),p(i),p(m,{icon:"camera-retro",size:"4x",onClick:e[1]||(e[1]=t=>s.scanning=!0),class:"text-gray-700 cursor-pointer absolute right-3 bottom-3"})]))};C.add([f,w,x,v,b]);const X=P({strict:!1,state:()=>({shopId:"",shopName:"",products:[],cartId:"",cartItems:[]}),mutations:{setShopId(t,e){t.shopId=e},setShopName(t,e){t.shopName=e},setCartId(t,e){t.cartId=e},setCartItems(t,e){t.cartItems=e},setProducts(t,e){t.products=e},addItemToCart(t,{uuid:e,quantity:a}){t.cartItems.push({uuid:e,quantity:a})},addCartItemQuantity(t,e){t.cartItems[e].quantity++},reduceCartItemQuantity(t,e){t.cartItems[e].quantity--},removeCartItem(t,e){t.cartItems.splice(e,1)},resetCart(t){t.cartItems=[]}},actions:{async getShop(t,e){t.commit("setShopId",e);const a=(await function(t){return new Promise(((e,a)=>{e({data:{id:t,name:"蓋婭科技",products:[{id:1,uuid:"1234-1234-1234",name:"香蔥麵包",unitPrice:25},{id:2,uuid:"qwer-qwer-qwer",name:"紅豆吐司",unitPrice:50},{id:3,uuid:"asdf-asdf-asdf",name:"蛋黃酥",unitPrice:30}]}})}))}(e)).data;t.commit("setShopName",a.name),t.commit("setProducts",a.products);const r=localStorage.getItem(t.getters.cartTTLKey),s=localStorage.getItem(t.getters.cartIDKey);s&&r&&!S.unix(r).isBefore(S())?(t.commit("setCartId",s),t.dispatch("restoreCart")):t.dispatch("createCart")},createCart(t){const e=k();t.commit("setCartId",e),localStorage.setItem(t.getters.cartIDKey,e),localStorage.setItem(e,JSON.stringify([])),t.dispatch("renewTTL")},restoreCart(t){const e=JSON.parse(localStorage.getItem(t.state.cartId));t.commit("setCartItems",e),t.dispatch("renewTTL")},saveCart(t){localStorage.setItem(t.state.cartId,JSON.stringify(t.state.cartItems)),t.dispatch("renewTTL")},renewTTL(t){let e=S().unix()+3600;localStorage.setItem(t.getters.cartTTLKey,e)},addToCart(t,e){const a=t.state.cartItems.findIndex((t=>t.uuid===e));a>-1?t.commit("addCartItemQuantity",a):t.commit("addItemToCart",{uuid:e,quantity:1}),t.dispatch("saveCart")},reduceFromCart(t,e){const a=t.state.cartItems.findIndex((t=>t.uuid===e));a>-1&&t.commit("reduceCartItemQuantity",a),t.dispatch("saveCart")},removeFromCart(t,e){const a=t.state.cartItems.findIndex((t=>t.uuid===e));a>-1&&t.commit("removeCartItem",a),t.dispatch("saveCart")},resetCart(t){t.commit("setCartItems",[]),t.dispatch("saveCart")},checkout(t){}},getters:{cartTTLKey:t=>`shop_${t.shopId}_cart_ttl`,cartIDKey:t=>`shop_${t.shopId}_cart_id`}}),Y=N(G);Y.use(X),Y.use(U),Y.component("font-awesome-icon",T),Y.mount("#app");
