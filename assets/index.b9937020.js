import{r as e,c as t,d as a,v as o,o as n,a as r,t as s,b as u,e as l,F as i,f as c,g as d,l as p,h as m,i as g,j as v,k as y,m as f,n as x,p as h,V as w}from"./vendor.b37014ca.js";const C=e(""),b=e(""),k=e([]),I=e(""),P=e([]),U=t((()=>`shop_${C.value}_cart_ttl`)),S=t((()=>`shop_${C.value}_cart_id`)),N=async e=>{C.value=e;const t=(await(o=e,new Promise(((e,t)=>{e({data:{id:o,name:"蓋婭科技",products:[{id:1,uuid:"1234-1234-1234",name:"香蔥麵包",unitPrice:25},{id:2,uuid:"qwer-qwer-qwer",name:"紅豆吐司",unitPrice:50},{id:3,uuid:"asdf-asdf-asdf",name:"蛋黃酥",unitPrice:30}]}})})))).data;var o;b.value=t.name,k.value=t.products;const n=localStorage.getItem(U.value),r=localStorage.getItem(S.value);r&&n&&!a.unix(n).isBefore(a())?(I.value=r,V()):q()},q=()=>{I.value=o(),localStorage.setItem(S.value,I.value),localStorage.setItem(I.value,JSON.stringify([])),_()},V=()=>{const e=JSON.parse(localStorage.getItem(I.value));P.value=e,_()},F=()=>{localStorage.setItem(I.value,JSON.stringify(P.value)),_()},_=()=>{let e=a().unix()+3600;localStorage.setItem(U.value,e)},z=e=>{const t=P.value.findIndex((t=>t.uuid===e));t>-1?P.value[t]++:P.value.push({uuid:e,quantity:1}),F()},A=e=>{const t=P.value.findIndex((t=>t.uuid===e));t>-1&&P.value[t]--,F()},R=e=>{const t=P.value.findIndex((t=>t.uuid===e));t>-1&&P.value.splice(t,1),F()},B=()=>{P.value=[],F()},H=()=>{},$={props:{shopName:{type:String,default:"我的商店"}}},j={class:"bg-gray-700 text-center text-white w-100 py-4"};$.render=function(e,t,a,o,u,l){return n(),r("nav",j,s(a.shopName)+" - 購物車 ",1)};const J={},O={class:"w-full absolute bottom-0 w-100 py-0 text-center text-gray-300 text-opacity-30"};J.render=function(e,t,a,o,s,u){return n(),r("footer",O," Copyright © 2021 蓋婭科技有限公司. All Rights Reserved. ")};const Q={props:{modelValue:Number,productUuid:[Number,String]},setup:e=>({addToCart:z,removeFromCart:R,reduceFromCart:A})},D={class:"flex justify-around px-1"},L={class:"text-gray-800"};Q.render=function(e,t,a,o,i,c){const d=u("font-awesome-icon");return n(),r("div",D,[a.modelValue>0?(n(),r(d,{key:0,icon:"minus",size:"lg",onClick:t[1]||(t[1]=e=>o.reduceFromCart(a.productUuid)),class:"text-gray-700 cursor-pointer"})):(n(),r(d,{key:1,icon:"trash",size:"lg",onClick:t[2]||(t[2]=e=>o.removeFromCart(a.productUuid)),class:"text-red-400 cursor-pointer"})),l("span",L,s(a.modelValue),1),l(d,{icon:"plus",size:"lg",onClick:t[3]||(t[3]=e=>o.addToCart(a.productUuid)),class:"text-gray-700 cursor-pointer"})])};const T={name:"Cart",components:{QuantityPanel:Q},setup(e){const a=t((()=>P.value.length<1||k.value.length<1?0:P.value.reduce(((e,t)=>{const a=k.value.find((e=>e.uuid===t.uuid));return e+t.quantity*(null==a?void 0:a.unitPrice)}),0)));return{items:P,products:k,total:a,resetCart:B,checkout:H,getProductByUuid:e=>k.value.find((t=>t.uuid===e))||{}}}},E={class:""},G={class:"flex flex-wrap w-full bg-gray-700 pb-2"},K={class:"w-6/12 bg-gray-200 p-1"},M={class:"w-6/12 bg-green-200 p-1"},W={class:"text-center w-9/12"},X={class:"p-5 bg-gray-700 text-white text-right"},Y={key:0},Z=l("span",null,"總價格",-1),ee={class:"ml-2"},te={key:1,class:"text-center"};T.render=function(e,t,a,o,d,p){const m=u("QuantityPanel");return n(),r("div",E,[l("div",G,[l("div",K,[l("button",{class:"w-full text-center rounded ring-2 ring-gray-700 ring-opacity-60",onClick:t[1]||(t[1]=(...e)=>o.resetCart&&o.resetCart(...e))},"清空購物車")]),l("div",M,[l("button",{class:"w-full text-center rounded ring-2 ring-gray-700 ring-opacity-60",onClick:t[2]||(t[2]=(...e)=>o.checkout&&o.checkout(...e))},"結帳")])]),(n(!0),r(i,null,c(o.items,(e=>(n(),r("div",{class:"py-5 px-2 flex w-full",key:e.uuid},[l("div",W,s(o.getProductByUuid(e.uuid).name)+" ($"+s(o.getProductByUuid(e.uuid).unitPrice)+") ",1),l(m,{class:"ml-auto w-3/12",modelValue:e.quantity,"onUpdate:modelValue":t=>e.quantity=t,productUuid:e.uuid},null,8,["modelValue","onUpdate:modelValue","productUuid"])])))),128)),l("div",X,[o.items.length>0?(n(),r("div",Y,[Z,l("span",ee,"$"+s(o.total),1)])):(n(),r("div",te," 請掃描商品 QR Code "))])])};const ae={components:{AppHeader:$,Cart:T,AppFooter:J},setup(t){d((()=>{const e=new URL(window.location.href).searchParams.get("shopId");N(e),o(window.location.href)}));const a=e(!1),o=e=>{const t=new URL(e).searchParams.get("addItem");t&&z(t)};return{scanning:a,shopId:C,shopName:b,decodeHandler:e=>{o(e),a.value=!1}}}},oe={key:0,class:"d-flex"},ne={key:1};ae.render=function(e,t,a,o,s,i){const c=u("AppHeader"),d=u("Cart"),p=u("AppFooter"),m=u("font-awesome-icon"),g=u("qrcode-stream");return o.scanning?(n(),r("div",ne,[l(m,{icon:"times-circle",size:"4x",onClick:t[2]||(t[2]=e=>o.scanning=!1),class:"text-gray-700 cursor-pointer absolute right-3 bottom-3"}),l(g,{onDecode:o.decodeHandler},null,8,["onDecode"])])):(n(),r("div",oe,[l(c,{shopName:o.shopName},null,8,["shopName"]),l(d),l(p),l(m,{icon:"camera-retro",size:"4x",onClick:t[1]||(t[1]=e=>o.scanning=!0),class:"text-gray-700 cursor-pointer absolute right-3 bottom-3"})]))};p.add([m,g,v,y,f]);const re=h(ae);re.use(w),re.component("font-awesome-icon",x),re.mount("#app");
